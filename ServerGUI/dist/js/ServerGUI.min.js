function selectPort(a){window.Handler.send(">GET:ports:;"),$("#portsModal").modal("show"),$('#portsModal input[name="id"]').val(a.ID)}function dl(a){}function clearForm(a){$(a).find("input, textarea, select").val("")}function Console(a){this.con=a,this.appendFromClient=function(a){this.append('<div class="msg"><i class="icon-laptop">You said:</i><pre>'+this.encodeHTML(a)+"</pre></div>")},this.appendFromServer=function(a){this.append('<div class="msg"><i class="icon-white icon-cloud">Server said:</i><pre>'+this.encodeHTML(a)+"</pre></div>")},this.appendError=function(a){this.append('<div class="msg"><i class="icon-white icon-warning-sign">Error:</i><pre>'+this.encodeHTML(a)+"</pre></div>")},this.append=function(a){scrollToBottom=!1,this.isAtBottom()&&(scrollToBottom=!0),this.con.html(this.con.html()+a),scrollToBottom&&this.scrollToBottom()},this.scrollToBottom=function(){this.con.scrollTop(this.con[0].scrollHeight)},this.isAtBottom=function(){return this.con[0].scrollHeight-this.con[0].clientHeight<=this.con.scrollTop()},this.encodeHTML=function(a){return $("<div/>").text(a).html()},this.getLocalCommands=function(){var a;return null===localStorage.commands||""===localStorage.commands||"undefined"==typeof localStorage.commands?(a=[],console.log("no storage set")):a=JSON.parse(localStorage.commands),a},this.addToLatestCommands=function(a){a=$.trim(a);var b=this.getLocalCommands();for(var c in b)b[c]==a&&b.splice(c,1);b.push(a),localStorage.commands=JSON.stringify(b)},this.handleKeyEvents=function(a,b){console.log("test"),13==a.which?$("#send").trigger("click"):38==a.which?(LatestCommands=this.getLocalCommands(),dl(LatestCommands),"undefined"==typeof window.commandIndex||window.commandIndex<0?window.commandIndex=LatestCommands.length:window.commandIndex--,0===window.commandIndex||window.commandIndex>LatestCommands.length?($(b).val(""),window.commandIndex--):$(b).val(LatestCommands[window.commandIndex-1]),dl(window.commandIndex)):40==a.which&&(LatestCommands=this.getLocalCommands(),dl(LatestCommands),"undefined"==typeof window.commandIndex||window.commandIndex>=LatestCommands.length||window.commandIndex<0?($(b).val(""),window.commandIndex=-1):(window.commandIndex++,$(b).val(LatestCommands[window.commandIndex-1])),dl(window.commandIndex))}}function View(a,b){this.Element=b,this.Name=a,this.Show=function(){this.Element.show(),dl(this)},this.Hide=function(){this.Element.hide()}}function Views(){this.ViewsList=[],this.Add=function(a,b){var c=new View(a,b);this.ViewsList.push(c),dl(this.ViewsList)},this.Show=function(a){this.hideAll(),this.ViewsList.some(function(b){return b.Name==a?(b.Show(),!0):void 0})},this.hideAll=function(){for(var a in this.ViewsList)this.ViewsList[a].Hide()}}function WebSocketClient(a,b){this.STATE_DISCONNECTED=0,this.STATE_CONNECTED=1,this.STATE_CONNECTING=2,this.STATE_CLOSED=3,this.serverURI=a,this.handler=b,this.ws=new WebSocket(a),this.handler.WebSocketC=this,this.ws.onopen=function(){b.onOpen()},this.ws.onmessage=function(a){b.onMessage(a)},this.ws.onclose=function(){b.onClose()},this.ws.onerror=function(a){b.onError(a),console.log(a)},this.send=function(a){this.ws.readyState==this.STATE_CONNECTED?this.handler.send(a):this.handler.onError("Not Connected")},this.disconnect=function(){b.onDisconnect(),this.ws.close()}}function WebSocketHandler(a){this.con=a,this.WebSocketC=null,this.Zones=new ZoneModel([new zone(new school,new roadc),new zone(new school,new roadc)]),ko.applyBindings(this.Zones),this.send=function(a){this.con.appendFromClient(a),this.WebSocketC.ws.send(a)},this.onOpen=function(){$(".connect").hide(),$(".disconnect").show(),$("#send").removeClass("disabled");var a={};a.type=1,a.payload={},a.payload.linktype=1,this.send(JSON.stringify(a)),this.Zones.addZone(1,"testManual"),this.Zones.addZone(2,"test2Manual")},this.onMessage=function(b){var c=b.data;this.con.appendFromServer(c);var d;try{d=JSON.parse(c)}catch(e){a.log("this is no json")}var f=this;if("ports"==d.payloadtype)f.Zones.availableArduinoPorts.removeAll(),$.each(d.payload,function(a){f.Zones.availableArduinoPorts.push(this)});else if("temperature"==d.payloadtype){{var g=-30;d.payload[0]+-g}$(".temp").css("width",percenT+"%")}dl("message type:"+d.payloadtype+", Message: "+d.payload)},this.onClose=function(){$(".connect").show(),$(".disconnect").hide(),$("#send").addClass("disabled"),this.Zones.removeAll()},this.onError=function(a){var b=a.data;this.con.appendError(b)},this.onDisconnect=function(){this.Zones.removeAll()},this.addZone=function(a){var b=0;"undefined"!=typeof a.X&&(b=a.X);var c=0;"undefined"!=typeof a.Y&&(c=a.Y);var d={};d.type=4,d.payload={},d.payload.zone={},d.payload.zone.x=b,d.payload.zone.y=c,this.send(JSON.stringify(d))},this.removeZone=function(a){var b={};b.type=5,b.payload={},b.payload.zone=a,this.send(JSON.stringify(b))},this.addSchool=function(a,b){var c=b.DateStart.replace(":","-"),d=b.DateEnd.replace(":","-"),e={};e.type=4,e.payload={},e.payload.school={},e.payload.school.Name=b.Name,e.payload.school.zoneID=a,e.payload.school.dateStart=c,e.payload.school.dateEnd=d,this.send(JSON.stringify(e))},this.removeSchool=function(a){var b={};b.type=5,b.payload={},b.payload.school=id,this.send(JSON.stringify(b))},this.addRoadC=function(a,b){var c={};c.type=4,c.payload={},c.payload.school={},c.payload.school.Name=school.Name,c.payload.school.zoneID=a,c.payload.school.dateStart=dateStart,c.payload.school.dateEnd=dateEnd,this.send(JSON.stringify(c))},this.removeRoadC=function(a){var b={};b.type=5,b.payload={},b.payload.roadConstruction=id,this.send(JSON.stringify(b))},this.connectArduino=function(a,b){var c={};c.type=3,c.payload={},c.payload.zone=id,c.payload.arduinoPort=b,this.send(JSON.stringify(c))},this.getData=function(){dl("Get All Zones");var a={};a.type=5,a.payload={},a.payload.roadConstruction=id,this.send(JSON.stringify(a)),dl("Get Com Ports"),a={},a.type=5,a.payload={},a.payload.roadConstruction=id,this.send(JSON.stringify(a))}}var Handler,WebSocketC,ViewHandler,Schools,RoadConstructions,Zones,Console;$(document).ready(function(){Console=new Console($("#console")),Handler=new WebSocketHandler(Console),ViewHandler=new Views,ViewHandler.Add("dashboard",$("#dashboard")),ViewHandler.Add("debug",$("#debug")),ViewHandler.Add("schools",$("#schools")),ViewHandler.Add("roadConstructions",$("#roadConstructions")),ViewHandler.Add("zones",$("#zones")),ViewHandler.Add("simulation",$("#simulation")),ViewHandler.Show("debug"),$(".connect").click(function(a){window.WebSocketC=new WebSocketClient(Settings.URI,window.Handler),a.preventDefault()}),$(".disconnect").click(function(a){window.WebSocketC.disconnect(),a.preventDefault()}),$("#send").click(function(a){var b=$("#prompt").val();window.WebSocketC.send(b),$("#prompt").val(""),Console.addToLatestCommands(b),$("#input .text_io").val(""),window.commandIndex=Console.getLocalCommands().length+1,a.preventDefault()}),$(".console_io").bind("keyup",function(a){Console.handleKeyEvents(a,this)}),$(document).ready(function(){window.AN.initialize()})});var ZoneModel=function(a){var b=this;b.zones=ko.observableArray(ko.utils.arrayMap(a,function(a){return{ID:a.ID,Name:ko.observable(a.Name),Arduino:ko.observable(a.Arduino),Schools:ko.observableArray(ko.utils.arrayMap(a.Schools,function(a){return{ID:a.ID,Name:a.Name,DateStart:a.DateStart,DateEnd:a.DateEnd}})),RoadConstructions:ko.observableArray(ko.utils.arrayMap(a.RoadConstructions,function(a){return{ID:a.ID,Name:a.Name,DateStart:a.DateStart,DateEnd:a.DateEnd}})),Vertexes:ko.observableArray(a.Vertexes),Edges:ko.observableArray(a.Edges)}})),b.availableArduinoPorts=ko.observableArray(),b.UIaddSchool=function(a){b.addSchool($("select[name='zoneID']",a).val(),$("input[name='schoolID']",a).val(),$("input[name='schoolName']",a).val(),$("input[name='dateStart']",a).val(),$("input[name='dateEnd']",a).val()),clearForm(a),$(".modal.in").modal("hide")},b.addSchool=function(a,c,d,e,f){var g=b.findZoneByID(a),h={ID:c,Name:d,DateStart:e,DateEnd:f};g.Schools.push(h),window.Handler.addSchool(a,h)},b.UIaddRoadC=function(a){b.addRoadC($("select[name='zoneID']",a).val(),$("input[name='roadcID']",a).val(),$("input[name='roadcName']",a).val(),$("input[name='dateStart']",a).val(),$("input[name='dateEnd']",a).val()),clearForm(a),$(".modal.in").modal("hide")},b.addRoadC=function(a,c,d,e,f){var g=b.findZoneByID(a),h={ID:c,Name:d,DateStart:e,DateEnd:f};g.RoadConstructions.push(h),window.Handler.addRoadC(a,h)},b.UIaddZone=function(a){b.addZone($("input[name='zoneID']",a).val(),$("input[name='zoneName']",a).val()),clearForm(a),$(".modal.in").modal("hide")},b.addArduino=function(a,c){var d=b.findZoneByID(a),e=b.zones.indexOf(d);console.log("index:"+e),console.log(d),b.zones()[e].Arduino(c),window.Handler.connectArduino(a,c)},b.UIaddArduino=function(a){b.addArduino($("input[name='id']",a).val(),$("select[name='arduinoPort']",a).val()),clearForm(a),$(".modal.in").modal("hide")},b.addZone=function(a,c){var d={ID:a,Name:ko.observable(c),Schools:ko.observableArray(),RoadConstructions:ko.observableArray(),Vertexes:ko.observableArray(),Edges:ko.observableArray(),Arduino:ko.observable("")};b.zones.push(d),window.Handler.addZone(d)},b.findZoneByID=function(a){var c;return ko.utils.arrayFirst(b.zones(),function(b){b.ID==a&&(c=b,console.log(c))}),c},b.UIremoveZone=function(a){b.zones.remove(a),window.Handler.removeZone(a.ID)},b.removeAll=function(a){b.zones.removeAll()},b.UIremoveSchool=function(a){$.each(b.zones(),function(){this.Schools.remove(a)}),window.Handler.removeSchool(a.ID)},b.UIremoveRoadC=function(a){$.each(b.zones(),function(){this.RoadConstructions.remove(a)}),window.Handler.removeZone(a.ID)}},school=function(){this.ID="5",this.Name="Doe",this.DateStart="",this.DateEnd=""},roadc=function(){this.ID="78",this.Name="roadconstruction",this.DateStart="23232",this.DateEnd="24778"},zone=function(a,b){this.ID=1,this.Name="Test",this.Schools=[a,a],this.RoadConstructions=[b,b],this.Vertexes=[],this.Edges=[],this.Arduino=""},Settings={URI:"ws://127.0.0.1:42424"};